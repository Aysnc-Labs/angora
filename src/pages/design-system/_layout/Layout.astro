---
import '../../../styles/global.css';
import '../../../styles/reset.css';
import '../../../styles/design-system.css';
import Sidebar from './Sidebar.tsx';

interface Props {
  title: string;
  description?: string;
  fullscreenHref?: string;
}

const { title, description, fullscreenHref } = Astro.props;

// Auto-discover pages by globbing the filesystem
const layoutFiles = import.meta.glob('/src/pages/design-system/layouts/*.astro');
const componentFiles = import.meta.glob('/src/pages/design-system/*.astro');
const wireframeFiles = import.meta.glob('/src/pages/design-system/wireframes/*.astro');

function toNavItems(files: Record<string, unknown>, baseHref: string) {
  return Object.keys(files)
    .map((path) => {
      const filename = path.split('/').pop()!.replace('.astro', '');
      if (filename === 'index') return null;
      const label = filename
        .split('-')
        .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
        .join(' ');
      return { href: `${baseHref}/${filename}`, label };
    })
    .filter(Boolean) as { href: string; label: string }[];
}

const layouts = toNavItems(layoutFiles, '/design-system/layouts');
const components = [
  { href: '/design-system', label: 'Style Guide' },
  ...toNavItems(componentFiles, '/design-system'),
];
const wireframes = toNavItems(wireframeFiles, '/design-system/wireframes');

const groups = [
  { title: 'Layouts', items: layouts, external: true },
  { title: 'Components', items: components },
  { title: 'Wireframes', items: wireframes },
];

const currentPath = Astro.url.pathname.replace(/\/$/, '') || '/';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex, nofollow" />
    <title>{title} â€” Design System</title>
  </head>
  <body>
    <div class="ds-shell">
      <Sidebar client:load groups={groups} currentPath={currentPath} />
      <main class="ds-page">
        <div class="ds-page-header">
          <h1>{title}</h1>
          {fullscreenHref && <a href={fullscreenHref} class="ds-fullscreen-link" target="_blank">View full screen</a>}
        </div>
        {description && <p class="ds-desc">{description}</p>}
        <slot />
      </main>
    </div>
  </body>
</html>
