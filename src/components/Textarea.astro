---
interface Props {
  state?: 'hover' | 'focus' | 'disabled' | 'error';
  size?: 'sm' | 'md' | 'lg';
  placeholder?: string;
  value?: string;
  label?: string;
  hint?: string;
  rows?: number;
}

const { state, size = 'md', placeholder = 'Enter text...', value, label, hint, rows = 4 } = Astro.props;

const sizeClasses: Record<string, string> = {
  sm: 'text-sm px-3 py-1.5',
  md: 'text-base px-4 py-2.5',
  lg: 'text-lg px-4 py-3',
};

const labelSizeClasses: Record<string, string> = {
  sm: 'text-xs',
  md: 'text-sm',
  lg: 'text-base',
};

function resolveClasses(): string {
  const parts = [
    'block w-full rounded-md border font-sans bg-card text-foreground resize-y',
    sizeClasses[size],
  ];

  if (state === 'hover') {
    parts.push('border-muted-foreground');
  } else if (state === 'focus') {
    parts.push('border-primary outline-2 outline-ring outline-offset-0');
  } else if (state === 'error') {
    parts.push('border-destructive text-destructive');
  } else if (state === 'disabled') {
    parts.push('border-border bg-muted text-muted-foreground cursor-not-allowed');
  } else if (!state) {
    parts.push(
      'border-input',
      'hover:border-muted-foreground',
      'focus:border-primary focus:outline-2 focus:outline-ring focus:outline-offset-0',
      'transition-colors duration-fast ease-default',
    );
  } else {
    parts.push('border-input');
  }

  return parts.join(' ');
}

const classes = resolveClasses();
const inputId = `textarea-${crypto.randomUUID().slice(0, 8)}`;
---

<div data-component="Textarea" class="flex flex-col gap-1.5">
  {label && (
    <label for={inputId} class={`font-medium text-foreground ${labelSizeClasses[size]}`}>{label}</label>
  )}
  <textarea
    id={inputId}
    class={classes}
    placeholder={placeholder}
    rows={rows}
    disabled={state === 'disabled' || undefined}
    data-state={state || undefined}
    aria-label={!label ? placeholder : undefined}
  >{value}</textarea>
  {hint && (
    <p class={`text-xs ${state === 'error' ? 'text-destructive' : 'text-muted-foreground'}`}>{hint}</p>
  )}
</div>
