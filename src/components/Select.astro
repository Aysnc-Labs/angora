---
interface Props {
  state?: 'hover' | 'focus' | 'disabled' | 'error';
  size?: 'sm' | 'md' | 'lg';
  label?: string;
  hint?: string;
  options?: string[];
  placeholder?: string;
}

const {
  state,
  size = 'md',
  label,
  hint,
  options = ['Option 1', 'Option 2', 'Option 3'],
  placeholder = 'Select an option',
} = Astro.props;

const sizeClasses: Record<string, string> = {
  sm: 'text-sm px-3 py-1.5 pr-8',
  md: 'text-base px-4 py-2.5 pr-10',
  lg: 'text-lg px-4 py-3 pr-10',
};

const labelSizeClasses: Record<string, string> = {
  sm: 'text-xs',
  md: 'text-sm',
  lg: 'text-base',
};

function resolveClasses(): string {
  const parts = [
    'block w-full rounded-md border font-sans bg-card text-foreground appearance-none cursor-pointer',
    sizeClasses[size],
  ];

  if (state === 'hover') {
    parts.push('border-muted-foreground');
  } else if (state === 'focus') {
    parts.push('border-primary outline-2 outline-ring outline-offset-0');
  } else if (state === 'error') {
    parts.push('border-destructive');
  } else if (state === 'disabled') {
    parts.push('border-border bg-muted text-muted-foreground cursor-not-allowed');
  } else if (!state) {
    parts.push(
      'border-input',
      'hover:border-muted-foreground',
      'focus:border-primary focus:outline-2 focus:outline-ring focus:outline-offset-0',
      'transition-colors duration-fast ease-default',
    );
  } else {
    parts.push('border-input');
  }

  return parts.join(' ');
}

const classes = resolveClasses();
const chevronSize = size === 'sm' ? 14 : size === 'lg' ? 20 : 16;
const inputId = `select-${crypto.randomUUID().slice(0, 8)}`;
---

<div data-component="Select" class="flex flex-col gap-1.5">
  {label && (
    <label for={inputId} class={`font-medium text-foreground ${labelSizeClasses[size]}`}>{label}</label>
  )}
  <div class="relative">
    <select
      id={inputId}
      class={classes}
      disabled={state === 'disabled' || undefined}
      data-state={state || undefined}
      aria-label={!label ? placeholder : undefined}
    >
      <option value="" disabled selected>{placeholder}</option>
      {options.map((opt) => (
        <option>{opt}</option>
      ))}
    </select>
    <div class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none">
      <svg width={chevronSize} height={chevronSize} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9" />
      </svg>
    </div>
  </div>
  {hint && (
    <p class={`text-xs ${state === 'error' ? 'text-destructive' : 'text-muted-foreground'}`}>{hint}</p>
  )}
</div>
