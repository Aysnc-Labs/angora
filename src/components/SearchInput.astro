---
interface Props {
  state?: 'hover' | 'focus' | 'disabled' | 'has-value';
  size?: 'sm' | 'md' | 'lg';
  placeholder?: string;
  value?: string;
  withClear?: boolean;
}

const { state, size = 'md', placeholder = 'Search...', value, withClear } = Astro.props;

const sizeClasses: Record<string, string> = {
  sm: 'text-sm py-1.5 pl-8 pr-3',
  md: 'text-base py-2.5 pl-10 pr-4',
  lg: 'text-lg py-3 pl-11 pr-4',
};

function resolveClasses(): string {
  const parts = [
    'block w-full rounded-md border font-sans bg-white text-gray-900',
    sizeClasses[size],
  ];

  if (withClear && (state === 'has-value' || value)) {
    parts.push(size === 'sm' ? 'pr-7' : size === 'lg' ? 'pr-10' : 'pr-9');
  }

  if (state === 'hover') {
    parts.push('border-gray-400');
  } else if (state === 'focus') {
    parts.push('border-primary-500 outline-2 outline-primary-300 outline-offset-0');
  } else if (state === 'disabled') {
    parts.push('border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed');
  } else if (state === 'has-value') {
    parts.push('border-gray-300');
  } else if (!state) {
    parts.push(
      'border-gray-300',
      'hover:border-gray-400',
      'focus:border-primary-500 focus:outline-2 focus:outline-primary-300 focus:outline-offset-0',
      'transition-colors duration-fast ease-default',
    );
  } else {
    parts.push('border-gray-300');
  }

  return parts.join(' ');
}

const classes = resolveClasses();
const iconSize = size === 'sm' ? 14 : size === 'lg' ? 20 : 16;
const showClear = withClear && (state === 'has-value' || value);
---

<div data-component="SearchInput" class="relative">
  <div class={`absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none ${size === 'sm' ? 'left-2.5' : ''}`}>
    <svg width={iconSize} height={iconSize} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8" />
      <line x1="21" y1="21" x2="16.65" y2="16.65" />
    </svg>
  </div>
  <input
    type="search"
    class={classes}
    placeholder={placeholder}
    value={value || (state === 'has-value' ? 'Search term' : undefined)}
    disabled={state === 'disabled' || undefined}
    data-state={state || undefined}
    aria-label={placeholder}
  />
  {showClear && (
    <button class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600" type="button" aria-label="Clear search">
      <svg width={iconSize} height={iconSize} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
  )}
</div>
