---
interface Props {
  state?: 'hover' | 'focus' | 'disabled';
  size?: 'sm' | 'md' | 'lg';
  checked?: boolean;
  indeterminate?: boolean;
  label?: string;
}

const { state, size = 'md', checked, indeterminate, label } = Astro.props;

const sizeMap: Record<string, { box: string; icon: number; text: string }> = {
  sm: { box: 'w-4 h-4', icon: 10, text: 'text-sm' },
  md: { box: 'w-5 h-5', icon: 12, text: 'text-base' },
  lg: { box: 'w-6 h-6', icon: 14, text: 'text-lg' },
};

const s = sizeMap[size];

function resolveBoxClasses(): string {
  const parts = [
    'inline-flex items-center justify-center rounded-sm border-2 shrink-0',
    s.box,
  ];

  if (checked || indeterminate) {
    parts.push('bg-primary-500 border-primary-500 text-white');
    if (state === 'hover') {
      parts.push('bg-primary-600 border-primary-600');
    }
  } else {
    parts.push('bg-white border-gray-300');
    if (state === 'hover') {
      parts.push('border-gray-400');
    }
  }

  if (state === 'focus') {
    parts.push('outline-2 outline-primary-300 outline-offset-2');
  } else if (state === 'disabled') {
    parts.push('opacity-50 cursor-not-allowed');
  }

  if (!state) {
    parts.push('transition-colors duration-fast ease-default');
  }

  return parts.join(' ');
}

const boxClasses = resolveBoxClasses();
---

<label data-component="Checkbox" class={`inline-flex items-center gap-2 ${state === 'disabled' ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'}`} data-state={state || undefined}>
  <span class={boxClasses}>
    {checked && (
      <svg width={s.icon} height={s.icon} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="20 6 9 17 4 12" />
      </svg>
    )}
    {indeterminate && (
      <svg width={s.icon} height={s.icon} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round">
        <line x1="5" y1="12" x2="19" y2="12" />
      </svg>
    )}
  </span>
  {label && <span class={`${s.text} text-gray-900`}>{label}</span>}
</label>
